{"version":3,"file":"pages/resource/index.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AACA;AACA;;AAEA;AAAA;AAmBA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AAGA;AACA;AAAA;AAEA;AAAA;AAEA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAIA;AAAA;AACA;AAGA;AAAA;AAGA;AAAA;AAAA;AAAA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEjEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEA;AAIA;;AAEA;AAAA;AAeA;AAsCA;AAAA;AAAA;AACA;AAAA;AAtCA;AACA;AACA;AACA;AAaA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AA8CA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AA4BA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AAKA;AACA;AACA;AAEA;AAGA;AACA;AACA;AAEA;AAGA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAEA;AAEA;AAAA;AAAA;AAAA;AACA;AAGA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAIA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAxNA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAxBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAoJA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AAAA;AAGA;AACA;AAEA;AACA;AACA;AAAA;AACA;AAEA;AAAA;AAGA;AAAA;AAMA;AAEA;AAGA;AACA;AACA;AAKA;AAAA;AAAA;AAGA;AAAA;AACA;AACA;AAAA;AAEA;AAEA;AACA;;;;;;;;;;;;;AC/WA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://wechat-app-hrbust/._src_pages_resource_index.ts","webpack://wechat-app-hrbust/._src_components_tab_Tab.tsx","webpack://wechat-app-hrbust/._src_components_tab_index.ts","webpack://wechat-app-hrbust/._src_pages_resource_Resource.tsx","webpack://wechat-app-hrbust/./src/pages/resource/index.ts?d27b"],"sourcesContent":["export { default } from './Resource'\n","import React from 'react'\nimport cn from 'classnames'\nimport { View } from '@tarojs/components'\n// import FixBlock from '@/components/fix-block'\n\nimport './Tab.less'\n\ninterface ITabItem<Key> {\n  key: Key\n  text?: string\n  render?: () => React.ReactNode\n}\n\nexport interface ITabProps<Key = string> {\n  currentIndex: number\n  tabList: ITabItem<Key>[]\n  children?: React.ReactNode\n  onChange?: (index: number, key?: Key, text?: string) => void\n  /** fix 距离顶部距离 */\n  fixBlockTop?: number\n  /** 点击相同 tab 是否有响应 */\n  canClickSameTab?: boolean\n}\n\nconst prefix = 'community-tab'\n\nexport default function TopBar<Key>(props: ITabProps<Key>) {\n  const {\n    currentIndex,\n    tabList,\n    onChange,\n    children,\n    canClickSameTab = false\n  } = props\n\n  return (\n    <View className={prefix}>\n      {/* <FixBlock top={0}> */}\n      <View className={`${prefix}-title`}>\n        {tabList.map((tabItem, index) => {\n          const { key, text, render } = tabItem\n          return (\n            <View\n              key={index}\n              className={cn(`${prefix}__item`, {\n                current: currentIndex === index\n              })}\n              onClick={() => {\n                if (currentIndex !== index || canClickSameTab) {\n                  onChange?.(index, key, text)\n                }\n              }}\n            >\n              {render ? render() : text}\n              {currentIndex === index && (\n                <View className={`${prefix}-active-bar`}></View>\n              )}\n            </View>\n          )\n        })}\n      </View>\n      {/* </FixBlock> */}\n      {children && <View className={`${prefix}__content`}>{children}</View>}\n    </View>\n  )\n}\n","export { default } from './Tab'\n","import React, { Fragment } from 'react'\nimport { Image, View, Input, Ad, Text } from '@tarojs/components'\nimport { loginModal, withRequest } from '@/utils'\nimport { APIS } from '@/services2'\nimport Taro from '@tarojs/taro'\nimport { goPage, routes } from '@/utils/router'\nimport { AtIcon } from 'taro-ui'\nimport { connect } from 'react-redux'\nimport { IRootState } from '@/types'\n\nimport SearchIcon from '@/assets/community-imgs/search.png'\nimport { withShare } from '@/components'\nimport Tab from '../../components/tab'\nimport { ITabProps } from '../../components/tab/Tab'\nimport ResourceItem, {\n  ResourceTag,\n  resourceInfo\n} from '../../components/resource-item'\n// import AddWallIcon from '../../imgs/add_wall.png'\n\nimport './Resource.less'\n\ntype PropsFromState = ReturnType<typeof mapStateToProps>\n\ntype ResourceState = {\n  list: GetApiResultType<typeof APIS.ResourceApi.apiResourceListGet>\n  activeTab: number\n  hasNext: boolean\n  loading: boolean\n  curTagIndex: number\n  activeArrow: boolean\n}\n\ntype ResourceProps = {} & PropsFromState\n\nexport class Resource extends React.Component<ResourceProps, ResourceState> {\n  pageNum = 0\n  pageSize = 20\n  fetching = false\n  tabList = [] as {\n    key: string\n    render?: () => React.ReactNode\n    api:\n      | typeof APIS.ResourceApi.apiResourceListGet\n      | typeof APIS.ResourceApi.apiResourceListLikeGet\n      | typeof APIS.ResourceApi.apiResourceListHotGet\n    api2?: typeof APIS.ResourceApi.apiResourceListTopGet\n    text?: string\n  }[]\n\n  tagList = [\n    {\n      key: '',\n      text: '全部'\n    }\n  ].concat(\n    Object.keys(resourceInfo).map(key => ({\n      key,\n      text: resourceInfo[key].name\n    }))\n  )\n\n  state: ResourceState = {\n    list: [],\n    activeTab: 0,\n    hasNext: true,\n    loading: true,\n    curTagIndex: 0,\n    activeArrow: false\n  }\n\n  showAllResource = true\n\n  constructor(props) {\n    super(props)\n    this.tabList = [\n      {\n        key: 'all',\n        render: () => {\n          if (!this.showAllResource) {\n            return resourceInfo[ResourceTag.STUDY].name\n          }\n          return (\n            <Text className=\"resource-tab\">\n              {this.tagList[this.state.curTagIndex].text}\n              <AtIcon\n                onClick={e => {\n                  e.stopPropagation()\n                  this.onShowTagSheet()\n                }}\n                value=\"chevron-down\"\n                size={20}\n                className={\n                  'resource-tab-icon' +\n                  (this.state.activeArrow ? ' resource-tab-icon--active' : '')\n                }\n              ></AtIcon>\n            </Text>\n          )\n        },\n        api: APIS.ResourceApi.apiResourceListGet,\n        api2: APIS.ResourceApi.apiResourceListTopGet\n      },\n      {\n        key: 'like',\n        text: '喜欢',\n        api: APIS.ResourceApi.apiResourceListLikeGet\n      },\n      {\n        key: 'hot',\n        text: '最热',\n        api: APIS.ResourceApi.apiResourceListHotGet\n      }\n    ]\n  }\n\n  onShowTagSheet = () => {\n    this.setState({\n      activeArrow: true\n    })\n    Taro.showActionSheet({\n      itemList: this.tagList.map(item => item.text),\n      success: res => {\n        // console.log(res)\n        this.setState({\n          // @ts-ignore\n          curTagIndex: res.tapIndex\n        })\n        this.fetchList(true)\n        this.setState({\n          activeArrow: false\n        })\n      },\n      fail: () => {\n        this.setState({\n          activeArrow: false\n        })\n      }\n    })\n  }\n\n  setStateP = (state: any): Promise<void> =>\n    new Promise(resolve => {\n      this.setState(state, () => resolve())\n    })\n\n  async componentDidShow() {\n    try {\n      await loginModal()\n      Taro.showLoading({\n        title: '加载中...'\n      })\n\n      await this.props.user.getUserInfoPromise\n\n      if (!this.props.user.config.global?.config?.showAllResource) {\n        this.showAllResource = false\n        await this.setStateP({\n          curTagIndex: 3\n        })\n      }\n\n      await this.init()\n      this.setState({\n        loading: false\n      })\n      Taro.hideLoading()\n    } catch (error) {\n      Taro.hideLoading()\n    }\n  }\n\n  init = async () => {\n    this.pageNum = 0\n    await this.fetchList(true)\n  }\n\n  fetchList = async (reset?: boolean, refresh?: boolean) => {\n    Taro.showLoading({\n      title: '加载中...'\n    })\n    this.fetching = true\n    let pageNum = String(this.pageNum)\n    let pageSize = String(this.pageSize)\n\n    // 刷新当前数据\n    if (refresh) {\n      pageNum = '0'\n      pageSize = String((this.pageNum + 1) * this.pageSize)\n    }\n\n    const api = this.tabList[this.state.activeTab].api\n    const api2 = this.tabList[this.state.activeTab].api2\n    const query: {\n      pageNum?: string\n      pageSize?: string\n      tag?: string\n    } = {\n      pageNum,\n      pageSize\n    }\n\n    const tag = this.tagList[this.state.curTagIndex].key\n\n    // tag 筛选\n    if (this.state.activeTab === 0 && tag) {\n      query.tag = tag\n    }\n\n    const fetchList = [withRequest(api)(query)]\n\n    // 置顶逻辑\n    if ((reset || refresh) && api2) {\n      fetchList.push(\n        withRequest(api2)({\n          pageNum: '0',\n          pageSize: '999'\n        })\n      )\n    }\n\n    const [commonRes, topRes] = await Promise.all(fetchList)\n\n    Taro.hideLoading()\n    this.fetching = false\n\n    const [commonErr, commonData] = commonRes\n\n    if (commonErr || !commonData) {\n      return Promise.reject()\n    }\n\n    let list = [] as ResourceState['list']\n\n    // 置顶逻辑\n    if ((reset || refresh) && topRes && !topRes[0] && topRes[1]) {\n      list = list.concat(topRes[1])\n    }\n\n    if (reset || refresh) {\n      list = list.concat(commonData)\n    } else {\n      list = this.state.list.concat(commonData)\n    }\n\n    console.log(list, 'list')\n\n    this.setState({\n      list,\n      hasNext: commonData.length >= this.pageSize\n    })\n  }\n\n  onTabChange: ITabProps['onChange'] = async index => {\n    if (this.state.activeTab === index) {\n      if (index === 0) {\n        this.onShowTagSheet()\n      }\n      return\n    }\n\n    if (index === 2 && !this.showAllResource) {\n      Taro.showToast({\n        title: '维护中，请稍后重试',\n        icon: 'none'\n      })\n      return\n    }\n\n    this.setState(\n      {\n        activeTab: index\n      },\n      () => {\n        this.init()\n      }\n    )\n  }\n\n  onReachBottom = () => {\n    if (!this.state.hasNext || this.fetching) {\n      return\n    }\n    this.pageNum++\n    return this.fetchList().catch(() => {\n      this.pageNum--\n    })\n  }\n\n  onPullDownRefresh = async () => {\n    this.init()\n    Taro.stopPullDownRefresh()\n  }\n\n  // onAddWallClick = () => {\n  //   navigateTo({\n  //     url: routes.createWall\n  //   })\n  // }\n\n  render() {\n    const { activeTab, loading, list = [] } = this.state\n\n    if (loading) {\n      return null\n    }\n\n    return (\n      <View className=\"resource\">\n        <View\n          className=\"resource-search\"\n          onClick={() => {\n            goPage(routes.searchResource)\n          }}\n        >\n          <Image className=\"resource-search__icon\" src={SearchIcon}></Image>\n          <Input placeholder=\"搜索关键词\" disabled></Input>\n        </View>\n        <Tab\n          currentIndex={activeTab}\n          tabList={this.tabList}\n          onChange={this.onTabChange}\n          canClickSameTab\n        >\n          {list.length === 0 ? (\n            <View className=\"community-no-data\">暂无内容</View>\n          ) : (\n            list.map((item, index) => {\n              return (\n                <Fragment key={item._id}>\n                  <ResourceItem\n                    showHotComments\n                    data={item}\n                    onClick={() =>\n                      goPage(`${routes.resourceDetail}?id=${item._id}`)\n                    }\n                    showTop={activeTab === 0}\n                  ></ResourceItem>\n                  {index !== 0 && index % 5 === 0 && (\n                    <View className=\"wall-ad\">\n                      {/* <Ad\n                        className=\"advertising\"\n                        unitId=\"adunit-2d76930b51ac0dbe\"\n                      ></Ad> */}\n                      {/* @ts-ignore */}\n                      <c-ad></c-ad>\n                    </View>\n                  )}\n                </Fragment>\n              )\n            })\n          )}\n        </Tab>\n        {/* <View className=\"wall__add-wall\" onClick={this.onAddWallClick}></View> */}\n        {/* {!hasNext && <View>到底了~</View>} */}\n      </View>\n    )\n  }\n}\n\nconst mapStateToProps = (state: IRootState) => ({\n  user: state.user\n})\n\nexport default connect<PropsFromState, {}, ResourceProps>(mapStateToProps)(\n  withShare({\n    title: '理工喵儿，资源分享专区'\n  })(Resource)\n)\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../../../node_modules/.pnpm/babel-loader@8.2.1_@babel+core@7.26.9_webpack@5.78.0_@swc+core@1.3.23_/node_modules/babel-loader/lib/index.js??ruleSet[1].rules[5].use[0]!./index.ts\"\nvar config = {\"navigationBarTitleText\":\"资源分享\",\"enablePullDownRefresh\":true};\n\n\nvar inst = Page(createPageConfig(component, 'pages/resource/index', {root:{cn:[]}}, config || {}))\n\n\nexport default component\n"],"names":[],"sourceRoot":""}