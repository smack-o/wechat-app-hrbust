{"version":3,"file":"pages/shop/index.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAmBA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAeA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAJA;AAAA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAqBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAJA;AAAA;AAMA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAEA;AACA;AAOA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AAEA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAxKA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAoDA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAfA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA8EA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAmCA;AAAA;AAAA;AAAA;AAAA;;AAEA;AACA;AACA;;AAEA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAKA;AAAA;AAAA;AAAA;AAAA;AACA;AAUA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAIA;AAAA;AAAA;AAGA;AAAA;AACA;AACA;AACA;AAAA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7QA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;;AAGA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAJA;AAAA;AAMA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAGA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAIA;AAAA;AAEA;AAAA;AACA;AAEA;AAAA;AAEA;AACA;AAEA;;;;;;;;;;;;;ACxEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://wechat-app-hrbust/._src_pages_shop_index.tsx","webpack://wechat-app-hrbust/._src_pages_shop__components_ItemCard_index.tsx","webpack://wechat-app-hrbust/./src/pages/shop/index.tsx?63e3"],"sourcesContent":["import React, { Component, Fragment } from 'react'\nimport { connect } from 'react-redux'\nimport Taro from '@tarojs/taro'\nimport { View, Text, Image, ScrollView } from '@tarojs/components'\nimport { IRootState } from '@/types'\nimport { pddSearch, getKeywords, generateGoods, getChannel } from '@/services/pdd'\nimport { AtSearchBar, AtIcon } from 'taro-ui'\nimport { cError } from '@/utils'\nimport { routes } from '@/utils/router'\nimport ItemCard from './_components/ItemCard'\n\nimport './index.less'\n\ntype PropsFromState = ReturnType<typeof mapStateToProps>\n\ntype PropsFromDispatch = {}\n\ntype PageOwnProps = {}\n\ntype PageState = {\n  pddList: any[],\n  searchValue: string,\n  loading: boolean,\n  // hotKeywords: string[],\n  showScrollBtn: boolean,\n  channels: { title: string, goods_list: any[] }[]\n}\n\ntype IProps = PropsFromState & PropsFromDispatch & PageOwnProps\n\nlet interstitialAd: Taro.InterstitialAd\n\nclass Index extends Component<IProps, PageState> {\n  state: Readonly<PageState> = {\n    pddList: [],\n    searchValue: '寝室必备',\n    loading: false,\n    // hotKeywords: [],\n    showScrollBtn: false,\n    channels: [],\n  }\n\n  pageNo = 1\n  loading = false\n\n  async componentDidShow () {\n    // // 在适合的场景显示插屏广告\n    // if (interstitialAd) {\n    //   interstitialAd.show().catch((err) => {\n    //     console.log(err)\n    //   })\n    // }\n\n    // this.pddSearch()\n    this.getKeywords()\n  }\n\n  // 搜索商品接口\n  pddSearch = async (reset = false) => {\n    // 是否需要重置 list\n    if (reset) {\n      this.pageNo = 1\n      this.scrollToTop()\n\n      // Taro 渲染有bug，所以这种情况只能重新渲染 loading dom\n      this.setState({\n        loading: true\n      })\n    }\n    if (this.loading) {\n      return\n    }\n    Taro.showLoading({\n      title: '加载中'\n    })\n    this.loading = true\n\n    const [err, res] = await cError(pddSearch({\n      page: this.pageNo,\n      keyword: this.state.searchValue,\n      // sort_type: 6,\n    }))\n\n    Taro.hideLoading()\n    this.loading = false\n    this.setState({\n      loading: false\n    })\n    if (!err) {\n      const list = res.data || []\n      this.setState({\n        pddList: this.pageNo === 1 ? list : [...this.state.pddList, ...list]\n      })\n      this.pageNo += 1\n    }\n  }\n\n  componentDidHide () { }\n\n  async onLoad() {\n    // 在页面onLoad回调事件中创建插屏广告实例\n    // 插屏广告\n    if (Taro.createInterstitialAd) {\n      interstitialAd = Taro.createInterstitialAd({\n        adUnitId: 'adunit-167f2a17e8f9ecc4'\n      })\n      interstitialAd.onLoad(() => { console.log('adload') })\n      interstitialAd.onError((error) => { console.log('aderror:', error) })\n      interstitialAd.onClose(() => { console.log('adclose') })\n    }\n\n    this.getChannels()\n    await this.getKeywords()\n    this.pddSearch(true)\n  }\n\n  getChannels = async () => {\n    const [err, res] = await cError(getChannel())\n    console.log(res)\n    if (!err) {\n      this.setState({\n        channels: res.data\n      })\n    }\n  }\n\n  getKeywords = async () => {\n    const [err, res] = await cError(getKeywords())\n    if (!err) {\n      this.setState({\n        // hotKeywords: res.data,\n        searchValue: res.data[0]\n      })\n    }\n  }\n\n  // 打开拼多多小程序\n  onPddGoodsClick = async (goods) => {\n    // const [] = goods;\n    console.log(goods)\n    const { search_id, goods_sign } = goods\n    const [err, res] = await cError(generateGoods({\n      goods_sign,\n      // sort_type: 6,\n      search_id\n    }))\n\n    if (!err) {\n      console.log(res)\n      const { app_id, page_path } = res.data.we_app_info\n      Taro.navigateToMiniProgram({\n        appId: app_id,\n        path: page_path,\n        // extraData: {\n        //   foo: 'bar'\n        // },\n        // envVersion: 'develop',\n        success(res) {\n        // 打开成功\n        }\n      })\n    }\n  }\n\n  // 搜索变更\n  onSearchChange = (value) => {\n    // 搜索条件变更需要重置页码\n    this.setState({\n      searchValue: value,\n    })\n  }\n\n  // 点击搜索\n  onSearch = () => {\n    this.pddSearch(true)\n  }\n\n  // 上拉加载\n  onReachBottom() {\n    this.pddSearch()\n  }\n\n  // 用户点击热门搜索\n  onHotKeyClick = (value) => {\n    this.setState({\n      searchValue: value\n    }, () => {\n      this.pddSearch(true)\n    })\n  }\n\n  scrollToTop = () => {\n    Taro.pageScrollTo({\n      scrollTop: 0,\n    })\n  }\n\n  // 监听滚动事件\n  onPageScroll = (e) => {\n    const { showScrollBtn } = this.state\n    if (e.scrollTop >= 200) {\n      !showScrollBtn && this.setShowScrollBtn(true)\n    } else {\n      showScrollBtn && this.setShowScrollBtn(false)\n    }\n  }\n\n  setShowScrollBtn = (show: boolean) => this.setState({ showScrollBtn: show })\n\n  goSearch = () => {\n    Taro.navigateTo({\n      url: routes.pddSearch\n    })\n  }\n  render () {\n    const { pddList, loading, channels, showScrollBtn } = this.state\n\n    // if (loading) {\n    //   return <Loading loading={loading}></Loading>\n    // }\n\n    return (\n      <View className=\"pdd-container\">\n        <View onClick={this.goSearch}>\n          <AtSearchBar\n            className=\"top-bar\"\n            showActionButton\n            value=\"\"\n            placeholder=\"点击搜索～\"\n            actionName=\"搜索\"\n            onActionClick={this.onSearch}\n            onChange={this.onSearchChange}\n            onConfirm={this.goSearch}\n            disabled\n          />\n        </View>\n\n        {\n          channels.map((channel) => {\n            return <ItemCard key={channel.title} title={channel.title} list={channel.goods_list} nowrap />\n          })\n        }\n\n\n\n        {/* <View className=\"channel-title\">寝室必备</View>\n        {\n          loading && <View className=\"pdd-list-loading\">加载中...</View>\n        } */}\n\n        <ItemCard title=\"寝室必备\" list={pddList} loading={loading} />\n\n\n        {/* 回到顶部 */}\n        {\n          showScrollBtn && <View className=\"scroll-top-button\" onClick={this.scrollToTop}>\n            <AtIcon className=\"arrow-up\" value=\"chevron-up\" size=\"30\" color=\"#333333\"></AtIcon>\n          </View>\n        }\n      </View>\n    )\n  }\n}\n\nconst mapStateToProps = (state: IRootState) => ({\n  user: state.user,\n  loading: state.global.loading\n})\n\nexport default connect<PropsFromState, PropsFromDispatch, PageOwnProps>(mapStateToProps)(Index)\n","import React, { Fragment, useCallback } from 'react'\nimport { View, Text, Image } from '@tarojs/components'\nimport cn from 'classnames'\nimport { generateGoods } from '@/services/pdd'\nimport { cError } from '@/utils'\nimport Taro from '@tarojs/taro'\n\nexport default function ItemCard (props: { title: string, list: any[], loading?: boolean, nowrap?: boolean }) {\n  const { title, list, loading, nowrap } = props\n\n\n  // 打开拼多多小程序\n  const onPddGoodsClick = useCallback(async (goods) => {\n    const { search_id, goods_sign } = goods\n    const [err, res] = await cError(generateGoods({\n      goods_sign,\n      // sort_type: 6,\n      search_id\n    }))\n\n    if (!err) {\n      console.log(res)\n      const { app_id, page_path } = res.data.we_app_info\n      Taro.navigateToMiniProgram({\n        appId: app_id,\n        path: page_path,\n        // extraData: {\n        //   foo: 'bar'\n        // },\n        // envVersion: 'develop',\n        success(res) {\n        // 打开成功\n        }\n      })\n    }\n  }, [])\n\n  if (loading) {\n    return <View className=\"pdd-list-loading\">加载中...</View>\n  }\n\n  return <Fragment>\n    <View className=\"channel-title\">{title}</View>\n    <View className={cn('pdd-wrapper', {\n      nowrap\n    })}\n    >\n      <View className=\"pdd-list\">\n        {\n          list.map((item) => {\n            const { coupon_discount } = item\n            return <View key={item.goods_id} className=\"pdd-item\" onClick={() => onPddGoodsClick(item)}>\n              <Image className=\"thumb\" src={item.goods_thumbnail_url}></Image>\n              {coupon_discount > 0 && <View className=\"coupon\">校园专属{coupon_discount / 100}元优惠券</View>}\n              <View className=\"name\">{item.goods_name}</View>\n              <View className=\"info\">\n                <View className=\"price\">\n                  <Text className=\"min-price\">￥{(item.min_group_price - coupon_discount) / 100}</Text> 拼团券后\n                </View>\n                {/* <View className=\"ori-price\">\n            {(item.min_normal_price + item.coupon_discount) / 100}\n          </View> */}\n                <View className=\"amount\">\n                  已抢{item.sales_tip}件\n                </View>\n              </View>\n            </View>\n          })\n        }\n      </View>\n    </View>\n  </Fragment>\n}\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../../../node_modules/.pnpm/babel-loader@8.2.1_@babel+core@7.26.9_webpack@5.78.0_@swc+core@1.3.23_/node_modules/babel-loader/lib/index.js??ruleSet[1].rules[5].use[0]!./index.tsx\"\nvar config = {\"navigationBarTitleText\":\"校园专属优惠\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/shop/index', {root:{cn:[]}}, config || {}))\n\n\nexport default component\n"],"names":[],"sourceRoot":""}