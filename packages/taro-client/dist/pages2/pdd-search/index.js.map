{"version":3,"file":"pages2/pdd-search/index.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AAkBA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAeA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AAAA;AAAA;AANA;AAAA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AA0BA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AAAA;AAAA;AANA;AAAA;AAQA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAEA;AACA;AAOA;AAAA;AAEA;AAEA;AACA;AAEA;AACA;AAEA;AAAA;AAGA;AACA;AACA;AACA;AAEA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAlKA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAsDA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AApBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAyEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAgCA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;;AAEA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAEA;AAEA;AAAA;AAAA;AAAA;AAEA;AAGA;AAAA;AACA;AACA;AACA;AAGA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AAEA;AACA;AAGA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAGA;AAAA;AAEA;AAEA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAGA;AAIA;AAAA;AAAA;AAAA;AACA;AAGA;AAAA;AACA;AAKA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAEA;AAGA;AAAA;AAAA;AAGA;AAAA;AACA;AACA;AACA;AAAA;AAEA;;;;;;;;;;;;;ACxTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://wechat-app-hrbust/._src_pages2_pdd-search_index.tsx","webpack://wechat-app-hrbust/./src/pages2/pdd-search/index.tsx?0027"],"sourcesContent":["import React, { Component } from 'react'\nimport { connect } from 'react-redux'\nimport Taro from '@tarojs/taro'\nimport { View, Text, Image, ScrollView } from '@tarojs/components'\nimport { IRootState } from '@/types'\nimport { pddSearch, getKeywords, generateGoods } from '@/services/pdd'\nimport { AtSearchBar, AtIcon } from 'taro-ui'\nimport { cError } from '@/utils'\n\nimport './index.less'\n\ntype PropsFromState = ReturnType<typeof mapStateToProps>\n\ntype PropsFromDispatch = {}\n\ntype PageOwnProps = {}\n\ntype PageState = {\n  pddList: any[]\n  searchValue: string\n  loading: boolean\n  hotKeywords: string[]\n  showScrollBtn: boolean\n}\n\ntype IProps = PropsFromState & PropsFromDispatch & PageOwnProps\n\nlet interstitialAd: Taro.InterstitialAd\n\nclass Index extends Component<IProps, PageState> {\n  state: Readonly<PageState> = {\n    pddList: [],\n    searchValue: '寝室必备',\n    loading: false,\n    hotKeywords: [],\n    showScrollBtn: false\n  }\n\n  pageNo = 1\n  loading = false\n\n  async componentDidShow() {\n    // // 在适合的场景显示插屏广告\n    // if (interstitialAd) {\n    //   interstitialAd.show().catch((err) => {\n    //     console.log(err)\n    //   })\n    // }\n\n    // this.pddSearch()\n    this.getKeywords()\n  }\n\n  // 搜索商品接口\n  pddSearch = async (reset = false) => {\n    // 是否需要重置 list\n    if (reset) {\n      this.pageNo = 1\n      this.scrollToTop()\n\n      // Taro 渲染有bug，所以这种情况只能重新渲染 loading dom\n      this.setState({\n        loading: true\n      })\n    }\n    if (this.loading) {\n      return\n    }\n    Taro.showLoading({\n      title: '加载中'\n    })\n    this.loading = true\n\n    const [err, res] = await cError(\n      pddSearch({\n        page: this.pageNo,\n        keyword: this.state.searchValue\n        // sort_type: 6,\n      })\n    )\n\n    Taro.hideLoading()\n    this.loading = false\n    this.setState({\n      loading: false\n    })\n    if (!err) {\n      const list = res.data || []\n      this.setState({\n        pddList: this.pageNo === 1 ? list : [...this.state.pddList, ...list]\n      })\n      this.pageNo += 1\n    }\n  }\n\n  componentDidHide() {}\n\n  async onLoad() {\n    // 在页面onLoad回调事件中创建插屏广告实例\n    // 插屏广告\n    if (Taro.createInterstitialAd) {\n      interstitialAd = Taro.createInterstitialAd({\n        adUnitId: 'adunit-167f2a17e8f9ecc4'\n      })\n      interstitialAd.onLoad(() => {\n        console.log('adload')\n      })\n      interstitialAd.onError(error => {\n        console.log('aderror:', error)\n      })\n      interstitialAd.onClose(() => {\n        console.log('adclose')\n      })\n    }\n\n    await this.getKeywords()\n    this.pddSearch(true)\n  }\n\n  getKeywords = async () => {\n    const [err, res] = await cError(getKeywords())\n    if (!err) {\n      this.setState({\n        hotKeywords: res.data,\n        searchValue: res.data[0]\n      })\n    }\n  }\n\n  // 打开拼多多小程序\n  onPddGoodsClick = async goods => {\n    const { search_id, goods_sign } = goods\n    const [err, res] = await cError(\n      generateGoods({\n        goods_sign,\n        // sort_type: 6,\n        search_id\n      })\n    )\n\n    if (!err) {\n      console.log(res)\n      const { app_id, page_path } = res.data.we_app_info\n      Taro.navigateToMiniProgram({\n        appId: app_id,\n        path: page_path,\n        // extraData: {\n        //   foo: 'bar'\n        // },\n        // envVersion: 'develop',\n        success(res) {\n          // 打开成功\n        }\n      })\n    }\n  }\n\n  // 搜索变更\n  onSearchChange = value => {\n    // 搜索条件变更需要重置页码\n    this.setState({\n      searchValue: value\n    })\n  }\n\n  // 点击搜索\n  onSearch = () => {\n    this.pddSearch(true)\n  }\n\n  // 上拉加载\n  onReachBottom() {\n    this.pddSearch()\n  }\n\n  // 用户点击热门搜索\n  onHotKeyClick = value => {\n    this.setState(\n      {\n        searchValue: value\n      },\n      () => {\n        this.pddSearch(true)\n      }\n    )\n  }\n\n  scrollToTop = () => {\n    Taro.pageScrollTo({\n      scrollTop: 0\n    })\n  }\n\n  // 监听滚动事件\n  onPageScroll = e => {\n    const { showScrollBtn } = this.state\n    if (e.scrollTop >= 200) {\n      !showScrollBtn && this.setShowScrollBtn(true)\n    } else {\n      showScrollBtn && this.setShowScrollBtn(false)\n    }\n  }\n\n  setShowScrollBtn = (show: boolean) => this.setState({ showScrollBtn: show })\n\n  render() {\n    const {\n      pddList,\n      loading,\n      searchValue,\n      hotKeywords,\n      showScrollBtn\n    } = this.state\n\n    // if (loading) {\n    //   return <Loading loading={loading}></Loading>\n    // }\n\n    return (\n      <View className=\"pdd-container\">\n        <AtSearchBar\n          className=\"top-bar\"\n          showActionButton\n          value={searchValue}\n          actionName=\"搜索\"\n          onActionClick={this.onSearch}\n          onChange={this.onSearchChange}\n          onConfirm={this.onSearch}\n        />\n        {hotKeywords.length > 0 && (\n          <View>\n            <View className=\"hot-keywords\">\n              <View className=\"title\">热门搜索：</View>\n              <ScrollView scrollX>\n                <View className=\"list\">\n                  {hotKeywords.map(item => {\n                    return (\n                      <View\n                        className=\"item\"\n                        key={item}\n                        onClick={() => this.onHotKeyClick(item)}\n                      >\n                        {item}\n                      </View>\n                    )\n                  })}\n                </View>\n              </ScrollView>\n            </View>\n          </View>\n        )}\n        {loading && <View className=\"pdd-list-loading\">加载中...</View>}\n        {!loading && (\n          <View className=\"pdd-wrapper\">\n            <View className=\"pdd-list\">\n              {pddList.map(item => {\n                const { coupon_discount } = item\n                return (\n                  <View\n                    key={item.goods_id}\n                    className=\"pdd-item\"\n                    onClick={() => this.onPddGoodsClick(item)}\n                  >\n                    <Image\n                      className=\"thumb\"\n                      src={item.goods_thumbnail_url}\n                    ></Image>\n                    {coupon_discount > 0 && (\n                      <View className=\"coupon\">\n                        校园专属{coupon_discount / 100}元优惠券\n                      </View>\n                    )}\n                    <View className=\"name\">{item.goods_name}</View>\n                    <View className=\"info\">\n                      <View className=\"price\">\n                        <Text className=\"min-price\">\n                          ￥{(item.min_group_price - coupon_discount) / 100}\n                        </Text>{' '}\n                        拼团券后\n                      </View>\n                      {/* <View className=\"ori-price\">\n                        {(item.min_normal_price + item.coupon_discount) / 100}\n                      </View> */}\n                      <View className=\"amount\">已抢{item.sales_tip}件</View>\n                    </View>\n                  </View>\n                )\n              })}\n            </View>\n          </View>\n        )}\n        {/* 回到顶部 */}\n        {showScrollBtn && (\n          <View className=\"scroll-top-button\" onClick={this.scrollToTop}>\n            <AtIcon\n              className=\"arrow-up\"\n              value=\"chevron-up\"\n              size=\"30\"\n              color=\"#333333\"\n            ></AtIcon>\n          </View>\n        )}\n      </View>\n    )\n  }\n}\n\nconst mapStateToProps = (state: IRootState) => ({\n  user: state.user,\n  loading: state.global.loading\n})\n\nexport default connect<PropsFromState, PropsFromDispatch, PageOwnProps>(\n  mapStateToProps\n)(Index)\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../../../node_modules/.pnpm/babel-loader@8.2.1_@babel+core@7.26.9_webpack@5.78.0_@swc+core@1.3.23_/node_modules/babel-loader/lib/index.js??ruleSet[1].rules[5].use[0]!./index.tsx\"\nvar config = {\"navigationBarTitleText\":\"校园专属优惠\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages2/pdd-search/index', {root:{cn:[]}}, config || {}))\n\n\nexport default component\n"],"names":[],"sourceRoot":""}